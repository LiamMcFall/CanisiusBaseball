---
title: "Blast_Viz"
author: "Liam McFall"
date: "1/31/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
```

STEPS WHEN SCALED

1) Download data for team
2) Loop through all data to combine in order to get team averages for time period
3) Loop through each player file, compiling report for that specific player

```{r}

source("/Users/liammcfall/CanisiusBaseball/BlastMergingCleaning.R")
library(dplyr)
library(ggplot2)
library(tidyr)
library(magrittr)
library(ggalt)
library(tibble)
library(gridExtra)

```
Load data
 - testing by loading 1 player for month of january
 
```{r}

player <- aggregateBlast('/Users/liammcfall/CanisiusBaseball/BlastPlayers/Burlingame/')
player <- blastClean(player)
player$week <- as.factor(isoweek(player$Date))

team <- aggregateBlast('/Users/liammcfall/CanisiusBaseball/BlastData/')
team <- blastClean(team)
team <- team %>%
  drop_na(On.Plane.Efficiency....) %>%
  drop_na(Bat.Speed..mph.) %>%
  drop_na(Time.to.Contact..sec.) %>%
  drop_na(Vertical.Bat.Angle..deg.)

```

Subset last 2 weeks of data for the player using iso standard week formatting. M-S

ie. Week 1 of 2020 was 12/30/19 - 01/05/20

Week 3 - 01/13/20 - 01/19/20

Week 4 - 01/20/20 - 01/26/20

```{r}

thisWeek <- as.numeric(readline(prompt = 'Enter week number: '))

playerSub <- subset(player, week %in% c(thisWeek - 1, thisWeek))

```

Metrics tables

```{r}

playerGrouped <- playerSub %>%
  group_by(week) %>%
  summarise("Rotational Acceleration (g)" = mean(Rotational.Acceleration..g.), 
            "On-Plane Efficiency (%)" = mean(On.Plane.Efficiency....), 
            "Connection Impact (deg)" = mean(Connection.at.Impact..deg.), 
            "Early Connection (deg)" = mean(Early.Connection..deg.),
            "Commit Time (s)" = mean(Time.to.Contact..sec.),
            "Bat Speed" = mean(Bat.Speed..mph.),
            "Attack Angle (deg)" = mean(Attack.Angle..deg.)) %>%
  t() %>%
  as.data.frame()

colnames(playerGrouped) <- c(paste("Week", playerGrouped[1,1]), paste("Week", playerGrouped[1,2]))
playerGrouped <- playerGrouped[-1,]
playerGrouped[,1] <- as.numeric(as.character(playerGrouped[,1]))
playerGrouped[,2] <- as.numeric(as.character(playerGrouped[,2]))
playerGrouped$Difference <- (playerGrouped[,2] - playerGrouped[,1])

playerSwingCount <- playerSub %>%
  group_by(week) %>%
  tally(name = "# Swings")

```

Experimentation with charts from the pdf posted in slack

```{r rotVope}

rotVope <- ggplot(playerSub, aes(x = On.Plane.Efficiency...., y = Rotational.Acceleration..g.)) +
  geom_encircle(aes(fill = week), alpha = .5, expand = .01) +
  geom_point(aes(color = week)) +
  geom_vline(xintercept = mean(team$On.Plane.Efficiency....)) +
  labs(y = 'Rotational Acceleration (g)', x = 'On Plane Efficieny (%)')


```

```{r attackVspeed}

attackVspeed <- ggplot(playerSub, aes(x = Bat.Speed..mph., y = Attack.Angle..deg.)) +
  geom_encircle(aes(fill = week), alpha = .5, expand = .01) +
  geom_point(aes(color = week)) +
  geom_vline(xintercept = mean(team$Bat.Speed..mph.)) +
  labs(y = 'Attack Angle (deg)', x = 'Bat Speed (mph)')

```

```{r rotVcommit}

rotVcommit <- ggplot(playerSub, aes(x = (Time.to.Contact..sec. * 1000), y = Rotational.Acceleration..g.)) +
  geom_encircle(aes(fill = week), alpha = .5, expand = .01) +
  geom_point(aes(color = week)) +
  geom_vline(xintercept = mean(team$Time.to.Contact..sec. * 1000)) +
  labs(y = 'Rotational Acceleration (g)', x = 'Time to Contact (ms)')

```

```{r conVvert}

conVvert <- ggplot(playerSub, aes(x = Vertical.Bat.Angle..deg., y = Connection.at.Impact..deg.)) +
  geom_encircle(aes(fill = week), alpha = .5, expand = .01) +
  geom_point(aes(color = week)) +
  geom_vline(xintercept = mean(team$Vertical.Bat.Angle..deg.)) +
  labs(y = 'Connection at Impact (deg)', x = 'Vertical Bat Angle (deg)') +
  scale_x_reverse()

```

```{r earlyconVvert}

earlyconVvert <- ggplot(playerSub, aes(x = Vertical.Bat.Angle..deg., y = Early.Connection..deg.)) +
  geom_encircle(aes(fill = week), alpha = .5, expand = .01) +
  geom_point(aes(color = week)) +
  geom_vline(xintercept = mean(team$Vertical.Bat.Angle..deg.)) +
  labs(y = 'Early Connection (deg)', x = 'Vertical Bat Angle (deg)') +
  scale_x_reverse()

```

```{r}

print(playerSwingCount)
print(playerGrouped)
grid.arrange(attackVspeed, rotVope, rotVcommit, conVvert, earlyconVvert, nrow = 3)

```

